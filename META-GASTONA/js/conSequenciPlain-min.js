/*
@project : https://github.com/wakeupthecat/gastona
@file    : conSequenciPlain-min.js
@version : 202111

Copyright (C) 2015-2021 Alejandro Xalabarder Aulet

@license : GNU General Public License (GPL) version 3 + commercial license through OpenSoftwareCongoLicenseV0.1

This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU General Public License for more details.
*/
function conSequenciPlain(I){function U(X,W){if(!X){return W}if(typeof X==="number"){return parseInt(X)}return parseInt(X[0][0])}function Q(X,W){for(var Y in W){var Z=X.indexOf(W[Y]);if(Z!=-1){return Z}}return -1}var o=I.sequenceTable;var N=Math.max(2,U(I.distanceAgents,30));var j=U(I.distanceTimeUnit,4);var C=U(I.maxGapTime,3);var M=I.autoElapsed;if(typeof M==="string"){M=(M==="1"||M==="true")}M=M!==false;var f=Q(o[0],["time","tstamp","stamp"]);var V=Q(o[0],["source","src","tx","ag1","agent1"]);var T=Q(o[0],["target","tgt","rx","ag2","agent2"]);var J=Q(o[0],["dir","arrow"]);var n=Q(o[0],["message","msg"]);var S=Q(o[0],["extrainfo","extra","info"]);var w={};var t=e(o,V,T);var d={};function u(){return f!=-1}function A(W){return w[W]||W}function e(ac,X,ad){function Y(ag){if(ag===undefined||ag.length==0){return}var af=ag.split("=");var ae=ag;if(af[1]){ae=A(af[1]);w[af[0]]=ae}if(ab.indexOf(ae)==-1&&!w[ae]){ab.push(ae)}}w={};var ab=[];var W=ac.length;if(W<2){return ab}if(ad===-1||X===-1){return ab}for(var aa in ac){if(aa==="0"){continue}if(X!=-1&&ac[aa][X]){Y(ac[aa][X])}if(ad!=-1&&ac[aa][ad]){Y(ac[aa][ad])}}for(var aa=ab.length-1;aa>=0;aa--){if(w[ab[aa]]){ab.splice(aa,1)}}for(var Z=0;Z<2;Z++){for(var aa in w){w[aa]=A(w[aa])}}return ab}function r(X,Z,Y){if(!M){return""}var W=d[""+Y+"/"+Z];delete d[""+Z+"/"+Y];if(W){W="("+Math.round((X-W)*1000)/1000+" s)"}else{d[""+Z+"/"+Y]=X}return W}if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(typeof String.prototype.trimTail!=="function"){String.prototype.trimTail=function(){return this.replace(/\s+$/g,"")}}if(typeof String.prototype.left!=="function"){String.prototype.left=function(W){return this.substring(0,W)}}if(typeof String.prototype.right!=="function"){String.prototype.right=function(W){return this.substring(this.length-W)}}function z(Y,Z){var W=[];for(var X=0;X<Z;X++){W.push(Y)}return W.join("")}var g=[];var p=13;var E=z(" ",N*0.06);var m=0;function H(W){g.push(W)}function L(Z,W){if(Z<0){return""}W=W||"|";var Y=W;for(var X=0;X<Z;X++){Y=Y+z(" ",N)+W}return Y}function K(W,Z,aa){var Y="",X="";if(W>Z){Y="<"+(aa?("--"+aa):"")}else{X=""+(aa?(aa+"--"):"")+">"}return(Y+z("-",(N+1)*Math.abs(W-Z)-1-Y.length-X.length)+X)}function q(ag,X,ab,aa){var ah,ai;if(X==-1){if(ab==-1){return}X=ab}else{if(ab==-1){ab=X}}var Z=Math.min(X,ab);var Y=Math.max(X,ab);var W=[];for(ah=0,ai=0;ah<aa.length;ah+=(N-E.length),ai++){W[ai]=aa.substring(ah,ah+(N-E.length))}var aj=(z(" ",10)+(ag>=0?ag:" ")).right(10)+z(" ",3);var af,ae,ad,ac;for(ai=0;ai<W.length;ai++){af=z(" ",N-E.length-W[ai].length);ae,ad,ac;if(X<=ab){ae=E+W[ai]+af;ad=Z;ac=t.length-Z-2}else{ae=af+W[ai]+E;ad=Y-1;ac=t.length-Y-1}H(z(" ",aj.length)+L(ad)+ae+L(ac))}if(X!=ab){H(aj+L(Z)+K(X,ab,r(ag,X,ab))+L(t.length-Y-1))}}var b=Math.round(N/2);var s=z(" ",p);var P=z(" ",p+1-b/2);var i=z(" ",N-b+1);var F="";var D="";var c=s+L(t.length-1);var G=s+L(t.length-1,"~");for(var k in t){var O=w[t[k]]||t[k];if(O.length>b){O=O.left(b)}var h=Math.round((b-O.length)/2);F=F+z(" ",h)+O+z(" ",b-h-O.length)+i;D=D+z("_",b)+i}F=P+F.trimTail();D=P+D.trimTail();H(D);H(F);H(D);m=null;for(var l in o){if(l==="0"){continue}var a=u()?o[l][f]:parseInt(l);var R=o[l][n];if(R===undefined){continue}if(j>0&&a>=0){var v=m?(a-m)*j:2;if(v>C*j){H(G);H(G)}else{for(var B=0;B<v;B++){H(c)}}}m=a;var y=t.indexOf(A(o[l][V]));var x=t.indexOf(A(o[l][T]));if(J==-1||["RQ","REQ","TX",">>"].indexOf((o[l][J]).toUpperCase())>=0){q(a,y,x,R)}else{q(a,x,y,R)}}H(c);H(D);H(F);H(D);return g.join("\n")};